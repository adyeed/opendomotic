<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="../template/default.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="content">
        
        <p:commandButton value="#{msg.New}" action="#{configMB.create()}" update="dialog"/>
        <p:commandButton action="/admin/image" value="#{msg.UploadImages}" ajax="false"/>

        <p:dialog id="dialog" header="#{msg.Device}" visible="#{configMB.visible}">
            <p:ajax event="close" listener="#{configMB.handleClose}"/>
            <p:focus context="dialog"/>
            <h:panelGrid columns="2">
                #{msg.Name}
                <p:inputText value="#{configMB.entity.name}"/>

                #{msg.ClassName}
                <p:inputText value="#{configMB.entity.deviceClassName}"/>      
                
                #{msg.Format}
                <p:inputText value="#{configMB.entity.format}"/>
                
                #{msg.ThreadId}
                <p:spinner value="#{configMB.entity.threadId}"/>
                
                #{msg.Enabled}
                <p:selectBooleanCheckbox value="#{configMB.entity.enabled}"/>  
                
                #{msg.Switchable}
                <p:selectBooleanCheckbox value="#{configMB.entity.switchable}"/>    
                
                #{msg.History}
                <p:selectBooleanCheckbox value="#{configMB.entity.history}"/> 
                
                <h:outputText value="#{msg.DefaultImage}"/>
                <p:selectOneMenu value="#{configMB.entity.deviceImageDefault}" converter="#{entityConverter}">
                    <f:selectItem itemLabel="#{msg.Select}"/>
                    <f:selectItems value="#{imageMB.listAll}" var="i" itemLabel="#{i.name}" itemValue="#{i}"/>                         
                </p:selectOneMenu>

                <h:outputText value="#{msg.SwitchImage}"/>
                <p:selectOneMenu value="#{configMB.entity.deviceImageSwitch}" converter="#{entityConverter}">
                    <f:selectItem itemLabel="#{msg.None}"/>
                    <f:selectItems value="#{imageMB.listAll}" var="i" itemLabel="#{i.name}"/>                         
                </p:selectOneMenu>
            </h:panelGrid>

            <p:dataTable value="#{configMB.listDeviceProperty}" var="p">
                <p:column>
                    <f:facet name="header">#{msg.Property}</f:facet>
                    <p:inputText value="#{p.name}"/>
                </p:column>
                <p:column>
                    <f:facet name="header">#{msg.Value}</f:facet>
                    <p:inputText value="#{p.value}"/>
                </p:column>
            </p:dataTable>

            <p:defaultCommand target="salvar"/>  
            <p:commandButton id="salvar" value="#{msg.Save}" action="#{configMB.save}" update="dialog,table"/>
            <p:commandButton id="cancelar" value="#{msg.Cancel}" action="#{configMB.cancel}" update="dialog"/>
        </p:dialog>

        <br/>

        <p:dataTable id="table" value="#{configMB.listAll}" var="config" emptyMessage="#{msg.WithoutDevice}">
            <p:column headerText="Thr">
                #{config.threadId}
            </p:column>
            <p:column headerText="#{msg.Name}">
                #{config.name}
            </p:column>
            <p:column headerText="#{msg.Value}">
                #{configMB.getDeviceValueAsString(config)}
            </p:column>
            <p:column headerText="#{msg.Ms}">
                #{configMB.getDeviceMillisResponse(config)}                
                <f:facet name="footer">
                    <p:commandLink value="#{configMB.getDeviceMillisResponseSum()}" onclick="alert('#{configMB.getDeviceMillisResponseFmt()}');"/>
                </f:facet>
            </p:column>
            <p:column headerText="#{msg.Error}">
                #{configMB.getDeviceErrors(config)}
                <f:facet name="footer">  
                    #{configMB.getDeviceErrorsSum()}
                </f:facet>
            </p:column>
            <p:column headerText="#{msg.ClassName}">
                #{config.deviceClassName}
            </p:column>
            <p:column headerText="#{msg.Enabled}" style="text-align: center;">
                <p:graphicImage value="../resources/images/button/checked.png" rendered="#{config.enabled}"/>
                <p:graphicImage value="../resources/images/button/unchecked.png" rendered="#{!config.enabled}"/>
            </p:column>
            <p:column headerText="#{msg.Switchable}" style="text-align: center;">
                <p:graphicImage value="../resources/images/button/checked.png" rendered="#{config.switchable}"/>
                <p:graphicImage value="../resources/images/button/unchecked.png" rendered="#{!config.switchable}"/>
            </p:column>
            <p:column headerText="#{msg.Format}">
                #{config.format}
            </p:column>
            <p:column headerText="#{msg.Properties}">
                #{config.listDeviceProperty}
            </p:column>
            <p:column headerText="#{msg.Image}" width="130">
                <p:graphicImage 
                    value="../resources/images/#{config.deviceImageDefault.fileName}" 
                    rendered="#{!empty config.deviceImageDefault}"/>
                <p:graphicImage 
                    value="../resources/images/#{config.deviceImageSwitch.fileName}" 
                    rendered="#{!empty config.deviceImageSwitch}"/>
            </p:column>
            <p:column width="300">
                <p:commandButton value="#{msg.Delete}" action="#{configMB.delete(config)}" update="table" onclick="return confirm('#{msg.ConfirmsTheExclusion}');"/>
                <p:commandButton value="#{msg.Edit}" action="#{configMB.edit(config)}" update="@form"/>
                <p:commandButton value="#{msg.Test}" action="#{configMB.test(config)}" update="@form"/>
            </p:column>
        </p:dataTable>

    </ui:define>

</ui:composition>
